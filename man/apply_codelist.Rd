% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/apply_codelist.R
\name{apply_codelist}
\alias{apply_codelist}
\title{Apply a harmonized codelist to a CDM database}
\usage{
apply_codelist(db_con, codelist)
}
\arguments{
\item{db_con}{A database connection object (e.g., a DuckDB connection) where the CDM tables
and concept tables are stored.}

\item{codelist}{A `data.table` containing the harmonized codelist. The codelist must include
the following columns:
\describe{
  \item{cdm_table_name}{Name of the CDM table or view to which the codes apply.}
  \item{cdm_column}{The column in the CDM table containing the code or coding system.}
  \item{concept_id}{The target concept identifier.}
  \item{code}{The source code to match.}
  \item{order_index}{An integer indicating processing order (parent = 1, children > 1).}
  \item{keep_value_column_name}{The column to keep as value when creating concepts.}
  \item{keep_date_column_name}{The column to keep as date when creating concepts.}
}}
}
\value{
No return value. The function updates the database by executing SQL queries.
}
\description{
This function applies a prepared codelist to the specified Common Data Model (CDM) database
connection. It processes concept mappings by grouping codes into families and applying SQL
queries to create harmonized concepts. Parent and child relationships in the codelist are
handled in hierarchical order.
}
\details{
The function works in three phases for each codelist family:
\enumerate{
  \item **Parent codes** are applied first using a predefined SQL script.
  \item **Child codes** are applied next, ordered by `order_index`.
  \item **Finalization** merges processed concepts back into the concepts table.
}

This implementation uses external SQL scripts:
\itemize{
  \item `create_concepts_1.sql` for parent concepts.
  \item `create_concepts_2.sql` for child concepts.
  \item `create_concepts_3.sql` for final merging.
}
}
\examples{
\dontrun{
# Assuming `concepts_db_conn_ref` is a valid DBI connection and `codelist_long` is prepared:
apply_codelist(concepts_db_conn_ref, codelist_long)
}

}
